{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport * as React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { API_ENDPOINT } from \"../utils/constants\";\nimport { Button } from '@rneui/themed';\nimport axios from 'axios';\nimport * as WebBrowser from 'expo-web-browser';\nimport { makeRedirectUri, useAuthRequest } from 'expo-auth-session';\nimport { _storeData, _retrieveData } from \"../utils/storage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nWebBrowser.maybeCompleteAuthSession();\nvar discovery = {\n  authorizationEndpoint: 'https://accounts.spotify.com/authorize',\n  tokenEndpoint: 'https://accounts.spotify.com/api/token'\n};\nvar getSpotifyCredentials = function () {\n  var _ref = _asyncToGenerator(function* () {\n    var res = yield axios.get(API_ENDPOINT + '/api/spotify-credentials');\n    var spotifyCredentials = res.data;\n    return spotifyCredentials;\n  });\n  return function getSpotifyCredentials() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getTokens = function () {\n  var _ref2 = _asyncToGenerator(function* (credentials, authorizationCode) {\n    var credsB64 = btoa(credentials.clientId + \":\" + credentials.clientSecret);\n    var response = yield fetch('https://accounts.spotify.com/api/token', {\n      method: 'POST',\n      headers: {\n        Authorization: \"Basic \" + credsB64,\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      body: \"grant_type=authorization_code&code=\" + authorizationCode + \"&redirect_uri=\" + credentials.redirectUri\n    });\n    console.log(\"HI2\");\n    var responseJson = response.json();\n    return responseJson;\n  });\n  return function getTokens(_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport default function LoginScreen(code) {\n  var _useAuthRequest = useAuthRequest({\n      clientId: '2032e93e5d6b4466a81a2fd6152cd0a6',\n      scopes: ['user-read-email', 'playlist-modify-public'],\n      usePKCE: false,\n      redirectUri: \"http://127.0.0.1:19006\"\n    }, discovery),\n    _useAuthRequest2 = _slicedToArray(_useAuthRequest, 3),\n    request = _useAuthRequest2[0],\n    response = _useAuthRequest2[1],\n    promptAsync = _useAuthRequest2[2];\n  React.useEffect(function () {\n    if ((response == null ? void 0 : response.type) === 'success') {\n      var _code = response.params.code;\n      try {\n        getSpotifyCredentials().then(function (credentials) {\n          getTokens(credentials, _code).then(function (responseJson) {\n            var accessToken = responseJson.access_token,\n              refreshToken = responseJson.refresh_token,\n              expiresIn = responseJson.expires_in;\n            var expirationTime = new Date().getTime() + expiresIn * 1000;\n            console.log(\"RESSSS\");\n            console.log(responseJson);\n            _storeData('accessToken', accessTokenNew);\n            _storeData('refreshToken', refreshTokenNew);\n            _storeData('expirationTime', expirationTimeNew);\n            props.setAccessToken(accessTokenTemp);\n            props.setRefreshToken(refreshTokenTemp);\n            props.setExpirationTime(expirationTimeTemp);\n            setLoading(false);\n          });\n        });\n      } catch (err) {\n        console.error(err);\n      }\n    }\n  }, [response]);\n  return _jsx(View, {\n    style: {\n      flex: 1,\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    children: _jsx(Button, {\n      title: \"Log In\",\n      onPress: function onPress() {\n        promptAsync();\n      },\n      type: \"outline\"\n    })\n  });\n}","map":{"version":3,"names":["React","API_ENDPOINT","Button","axios","WebBrowser","makeRedirectUri","useAuthRequest","_storeData","_retrieveData","maybeCompleteAuthSession","discovery","authorizationEndpoint","tokenEndpoint","getSpotifyCredentials","res","get","spotifyCredentials","data","getTokens","credentials","authorizationCode","credsB64","btoa","clientId","clientSecret","response","fetch","method","headers","Authorization","body","redirectUri","console","log","responseJson","json","LoginScreen","code","scopes","usePKCE","request","promptAsync","useEffect","type","params","then","accessToken","access_token","refreshToken","refresh_token","expiresIn","expires_in","expirationTime","Date","getTime","accessTokenNew","refreshTokenNew","expirationTimeNew","props","setAccessToken","accessTokenTemp","setRefreshToken","refreshTokenTemp","setExpirationTime","expirationTimeTemp","setLoading","err","error","flex","alignItems","justifyContent"],"sources":["/Users/paulgaudin/Desktop/r_cast/rcast_frontend/src/screens/loginScreen.js"],"sourcesContent":["import * as React from 'react';\nimport { View, Text } from \"react-native\";\nimport { API_ENDPOINT } from \"../utils/constants\"\nimport { Button } from '@rneui/themed';\n\nimport axios from 'axios'\n\nimport * as WebBrowser from 'expo-web-browser';\nimport { makeRedirectUri, useAuthRequest } from 'expo-auth-session';\n\nimport {_storeData, _retrieveData} from \"../utils/storage\"\n\n\nWebBrowser.maybeCompleteAuthSession();\n\nconst discovery = {\n    authorizationEndpoint: 'https://accounts.spotify.com/authorize',\n    tokenEndpoint: 'https://accounts.spotify.com/api/token',\n  };\n  \n  const getSpotifyCredentials = async () => {\n    const res = await axios.get(API_ENDPOINT + '/api/spotify-credentials')\n    const spotifyCredentials = res.data\n    return spotifyCredentials\n  }\n\n\nconst getTokens = async (credentials, authorizationCode) => {\n    const credsB64 = btoa(`${credentials.clientId}:${credentials.clientSecret}`);\n\n    const response = await fetch('https://accounts.spotify.com/api/token', {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${credsB64}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: `grant_type=authorization_code&code=${authorizationCode}&redirect_uri=${\n        credentials.redirectUri\n      }`,\n    });\n    console.log(\"HI2\")\n    const responseJson =  response.json();\n    return responseJson\n}\n\nexport default function LoginScreen(code) {\n\n\n    \n\nconst [request, response, promptAsync] = useAuthRequest(\n    {\n        clientId: '2032e93e5d6b4466a81a2fd6152cd0a6',\n        scopes: ['user-read-email', 'playlist-modify-public'],\n        // In order to follow the \"Authorization Code Flow\" to fetch token after authorizationEndpoint\n        // this must be set to false\n        usePKCE: false,\n        redirectUri: \"http://127.0.0.1:19006\"\n    },\n    discovery\n    );\n\n  React.useEffect(() => {\n    if (response?.type === 'success') {\n      const { code } = response.params;\n    //   console.log(\"CODE\")\n    //   console.log(code)\n\n    try {\n        getSpotifyCredentials().then(credentials => {\n            getTokens(credentials, code).then(responseJson => {\n                const {\n                    access_token: accessToken,\n                    refresh_token: refreshToken,\n                    expires_in: expiresIn,\n                    } = responseJson;\n                \n                    const expirationTime = new Date().getTime() + expiresIn * 1000;\n                    console.log(\"RESSSS\")\n                    console.log(responseJson)\n                    _storeData('accessToken', accessTokenNew);\n                    _storeData('refreshToken', refreshTokenNew);\n                    _storeData('expirationTime', expirationTimeNew);\n                    props.setAccessToken(accessTokenTemp)\n                    props.setRefreshToken(refreshTokenTemp)\n                    props.setExpirationTime(expirationTimeTemp)\n                    setLoading(false)\n            })\n        })\n\n    } catch (err) {\n        console.error(err);\n    }\n    }\n  }, [response]);\n\n\n\n\n\n   return (\n    <View style={{ flex: 1, alignItems: 'center', justifyContent: 'center' }}>\n\n        <Button\n        title=\"Log In\"\n        onPress={() => {\n            promptAsync();\n        }}\n        type=\"outline\"\n        /> \n\n                \n</View>\n   );\n }"],"mappings":"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"},"metadata":{},"sourceType":"module"}