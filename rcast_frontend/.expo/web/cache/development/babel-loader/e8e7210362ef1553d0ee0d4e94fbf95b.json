{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport * as React from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { API_ENDPOINT } from \"../utils/constants\";\nimport { Button } from '@rneui/themed';\nimport axios from 'axios';\nimport * as WebBrowser from 'expo-web-browser';\nimport { makeRedirectUri, useAuthRequest } from 'expo-auth-session';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nWebBrowser.maybeCompleteAuthSession();\nvar discovery = {\n  authorizationEndpoint: 'https://accounts.spotify.com/authorize',\n  tokenEndpoint: 'https://accounts.spotify.com/api/token'\n};\nvar getSpotifyCredentials = function () {\n  var _ref = _asyncToGenerator(function* () {\n    var res = yield axios.get(API_ENDPOINT + '/api/spotify-credentials');\n    var spotifyCredentials = res.data;\n    return spotifyCredentials;\n  });\n  return function getSpotifyCredentials() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getTokens = function () {\n  var _ref2 = _asyncToGenerator(function* (credentials, authorizationCode) {\n    var credsB64 = btoa(credentials.clientId + \":\" + credentials.clientSecret);\n    var response = yield fetch('https://accounts.spotify.com/api/token', {\n      method: 'POST',\n      headers: {\n        Authorization: \"Basic \" + credsB64,\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      body: \"grant_type=authorization_code&code=\" + authorizationCode + \"&redirect_uri=\" + credentials.redirectUri\n    });\n    console.log(\"HI2\");\n    var responseJson = response.json();\n  });\n  return function getTokens(_x, _x2) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport default function LoginScreen(code) {\n  var getAndSetTokens = function getAndSetTokens(code) {\n    try {\n      getSpotifyCredentials().then(function (credentials) {\n        getTokens(credentials, code).then(function (responseJson) {\n          var accessToken = responseJson.access_token,\n            refreshToken = responseJson.refresh_token,\n            expiresIn = responseJson.expires_in;\n          var expirationTime = new Date().getTime() + expiresIn * 1000;\n          console.log(\"RESSSS\");\n          console.log(responseJson);\n        });\n      });\n    } catch (err) {\n      console.error(err);\n    }\n  };\n  var _useAuthRequest = useAuthRequest({\n      clientId: '2032e93e5d6b4466a81a2fd6152cd0a6',\n      scopes: ['user-read-email', 'playlist-modify-public'],\n      usePKCE: false,\n      redirectUri: \"http://127.0.0.1:19006\"\n    }, discovery),\n    _useAuthRequest2 = _slicedToArray(_useAuthRequest, 3),\n    request = _useAuthRequest2[0],\n    response = _useAuthRequest2[1],\n    promptAsync = _useAuthRequest2[2];\n  React.useEffect(function () {\n    if ((response == null ? void 0 : response.type) === 'success') {\n      var _code = response.params.code;\n      getAndSetTokens(_code);\n    }\n  }, [response]);\n  return _jsx(View, {\n    style: {\n      flex: 1,\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    children: _jsx(Button, {\n      title: \"Log In\",\n      onPress: function onPress() {\n        promptAsync();\n      },\n      type: \"outline\"\n    })\n  });\n}","map":{"version":3,"names":["React","API_ENDPOINT","Button","axios","WebBrowser","makeRedirectUri","useAuthRequest","maybeCompleteAuthSession","discovery","authorizationEndpoint","tokenEndpoint","getSpotifyCredentials","res","get","spotifyCredentials","data","getTokens","credentials","authorizationCode","credsB64","btoa","clientId","clientSecret","response","fetch","method","headers","Authorization","body","redirectUri","console","log","responseJson","json","LoginScreen","code","getAndSetTokens","then","accessToken","access_token","refreshToken","refresh_token","expiresIn","expires_in","expirationTime","Date","getTime","err","error","scopes","usePKCE","request","promptAsync","useEffect","type","params","flex","alignItems","justifyContent"],"sources":["/Users/paulgaudin/Desktop/r_cast/rcast_frontend/src/screens/loginScreen.js"],"sourcesContent":["import * as React from 'react';\nimport { View, Text } from \"react-native\";\nimport { API_ENDPOINT } from \"../utils/constants\"\nimport { Button } from '@rneui/themed';\n\nimport axios from 'axios'\n\nimport * as WebBrowser from 'expo-web-browser';\nimport { makeRedirectUri, useAuthRequest } from 'expo-auth-session';\n\n\nWebBrowser.maybeCompleteAuthSession();\n\nconst discovery = {\n    authorizationEndpoint: 'https://accounts.spotify.com/authorize',\n    tokenEndpoint: 'https://accounts.spotify.com/api/token',\n  };\n  \n  const getSpotifyCredentials = async () => {\n    const res = await axios.get(API_ENDPOINT + '/api/spotify-credentials')\n    const spotifyCredentials = res.data\n    return spotifyCredentials\n  }\n\n\nconst getTokens = async (credentials, authorizationCode) => {\n    const credsB64 = btoa(`${credentials.clientId}:${credentials.clientSecret}`);\n\n    const response = await fetch('https://accounts.spotify.com/api/token', {\n      method: 'POST',\n      headers: {\n        Authorization: `Basic ${credsB64}`,\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: `grant_type=authorization_code&code=${authorizationCode}&redirect_uri=${\n        credentials.redirectUri\n      }`,\n    });\n    console.log(\"HI2\")\n    const responseJson =  response.json();\n}\n\nexport default function LoginScreen(code) {\n\n    \n    const getAndSetTokens = (code) => {\n        try {\n            getSpotifyCredentials().then(credentials => {\n                getTokens(credentials, code).then(responseJson => {\n                    const {\n                        access_token: accessToken,\n                        refresh_token: refreshToken,\n                        expires_in: expiresIn,\n                      } = responseJson;\n                  \n                      const expirationTime = new Date().getTime() + expiresIn * 1000;\n                      console.log(\"RESSSS\")\n                      console.log(responseJson)\n                })\n            })\n\n        } catch (err) {\n          console.error(err);\n        }\n      }\n    \n\nconst [request, response, promptAsync] = useAuthRequest(\n    {\n        clientId: '2032e93e5d6b4466a81a2fd6152cd0a6',\n        scopes: ['user-read-email', 'playlist-modify-public'],\n        // In order to follow the \"Authorization Code Flow\" to fetch token after authorizationEndpoint\n        // this must be set to false\n        usePKCE: false,\n        redirectUri: \"http://127.0.0.1:19006\"\n    },\n    discovery\n    );\n\n  React.useEffect(() => {\n    if (response?.type === 'success') {\n      const { code } = response.params;\n    //   console.log(\"CODE\")\n    //   console.log(code)\n        getAndSetTokens(code)\n    }\n  }, [response]);\n\n\n\n\n\n   return (\n    <View style={{ flex: 1, alignItems: 'center', justifyContent: 'center' }}>\n\n        <Button\n        title=\"Log In\"\n        onPress={() => {\n            promptAsync();\n        }}\n        type=\"outline\"\n        /> \n\n                \n</View>\n   );\n }"],"mappings":"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"},"metadata":{},"sourceType":"module"}